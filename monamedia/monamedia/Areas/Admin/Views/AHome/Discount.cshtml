
@{
    ViewBag.Title = "Discount";
    Layout = "~/Areas/Admin/Views/Shared/AdminLayoutPage1.cshtml";
}
<style>
    .row_element-button {
        display: flex;
        flex-wrap: wrap;
        border-bottom: 1px solid #ddd;
        padding-bottom: 10px;
        margin-bottom: 10px;
        text-align: left;
        text-size-adjust: 100%;
        justify-content: space-between;
    }

    .btn-add {
        background-color: rgb(157, 249, 157);
    }

    .btn-delete {
        background-color: rgb(208, 208, 208);
    }


    .btn + .btn {
        margin-left: 20px;
    }

    .btn:hover {
        opacity: 0.8;
        background-color: bisque;
    }
</style>
@model List<monamedia.Models.Discount>
<main class="main">
    <div class="main_title">
        <p class="main_title-label "><b>Danh sách đợt giảm giá</b></p>
        <div id="clock"></div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <div class="title">
                <div class="title-body">
                    <div class="row_element-button">
                        <div>
                            <a class="btn btn-add" type="button" href="~/Admin/AHome/AddDiscount" title="Thêm">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-percent" viewBox="0 0 16 16">
                                    <path d="M13.442 2.558a.625.625 0 0 1 0 .884l-10 10a.625.625 0 1 1-.884-.884l10-10a.625.625 0 0 1 .884 0M4.5 6a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3m0 1a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5m7 6a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3m0 1a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5" />
                                </svg>
                                <i class="fas fa-plus"></i>
                                Tạo đợt giảm giá
                            </a>
                            @* <a id="deleteSelected" class="btn btn-delete" type="button" title="Xóa">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash3" viewBox="0 0 16 16">
                    <path d="M6.5 1h3a.5.5 0 0 1 .5.5v1H6v-1a.5.5 0 0 1 .5-.5M11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3A1.5 1.5 0 0 0 5 1.5v1H1.5a.5.5 0 0 0 0 1h.538l.853 10.66A2 2 0 0 0 4.885 16h6.23a2 2 0 0 0 1.994-1.84l.853-10.66h.538a.5.5 0 0 0 0-1zm1.958 1-.846 10.58a1 1 0 0 1-.997.92h-6.23a1 1 0 0 1-.997-.92L3.042 3.5zm-7.487 1a.5.5 0 0 1 .528.47l.5 8.5a.5.5 0 0 1-.998.06L5 5.03a.5.5 0 0 1 .47-.53Zm5.058 0a.5.5 0 0 1 .47.53l-.5 8.5a.5.5 0 1 1-.998-.06l.5-8.5a.5.5 0 0 1 .528-.47M8 4.5a.5.5 0 0 1 .5.5v8.5a.5.5 0 0 1-1 0V5a.5.5 0 0 1 .5-.5" />
                </svg> <i class="fas fa-trash-alt"></i> Xóa nhiều dòng
            </a>*@
                        </div>
                        <div>
                            <form class="d-flex flex-row align-items-center flex-wrap" action="/Admin/AHome/Discount">
                                <label for="search" class="mx-2 my-1">Tìm kiếm</label>
                                <input type="search" class="form-control w-auto" id="search" name="search" placeholder="Tìm kiếm " value="@ViewBag.Search" />
                                <button type="submit" class="btn btn-primary mx-2" style="background-color:blue">Tìm</button>
                            </form>
                        </div>

                    </div>
                    <table class="table table-hover table-bordered js-copytextarea" cellpadding="0" cellspacing="0" border="0"
                           id="sampleTable">
                        <thead>
                            <tr>
                               
                                <th>ID giảm giá</th>
                                <th width="150">Tên giảm giá</th>
                                <th>Ngày bắt đầu</th>
                                <th>Ngày kết thúc</th>
                                <th>Phần trăm</th>
                                <th width="100">Tính năng</th>
                            </tr>
                        </thead>
                        <tbody>

                            @foreach (var discount in Model)
                            {
                                <tr data-discountID="@discount.discountID">
                                    
                                    <td>@discount.discountID</td>
                                    <td>@discount.nameDiscount</td>
                                    <td>@discount.ngayBatDau.Value.ToString("dd-MM-yyyy")</td>
                                    <td>@discount.ngayKetThuc.Value.ToString("dd-MM-yyyy")</td>
                                    <td>@discount.per_cent</td>
                                    <td class="table-td-center">
                                        <button class="btn btn-primary btn-sm detail" data-bs-toggle="modal" data-bs-target="#detailModal" title="Chi tiết" id="show-emp" data-discountid="@discount.discountID"
                                               style="background-color: white; margin-left:20px;">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" class="bi bi-three-dots" viewBox="0 0 16 16" style="background-color:white;">
                                                <path d="M3 9.5a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3m5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3m5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3" />
                                            </svg>
                                            <i class="fas fa-edit"></i>
                                        </button>
                                    </td>
                                </tr>
                            }

                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</main>
<div class="modal fade" id="detailModal" tabindex="-1" aria-labelledby="detailModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="detailModalLabel">Chi tiết giảm giá</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- Form chỉnh sửa thông tin tài khoản -->

                <div id="tableContainer">
                    <table class="table table-hover table-bordered js-copytextarea" cellpadding="0" cellspacing="0" border="0"
                           id="sampleTable">
                        <thead>
                            <tr>
                                <th width="100">ID sản phẩm</th>
                                <th width="300">Tên sản phẩm</th>
                                <th width="100">Màu sắc</th>
                                <th width="100">Thương hiệu</th>
                                <th width="100">Loại sản phẩm</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
            </div>
        </div>
    </div>
</div>
<script src="~/Scripts/bootstrap.min.js"></script>
<script src="~/Scripts\jquery-3.7.1.min.js"></script>

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script>
    $(document).ready(function () {
        $('#detailModal').on('show.bs.modal', function (e) {
            var discountId = $(e.relatedTarget).data('discountid'); // Lấy ID của giảm giá từ button
            var modal = $(this);
            $.ajax({
                url: '/Discount/GetDiscountProducts', // Đã sửa đường dẫn API
                type: 'GET',
                data: { discountId: discountId },
                success: function (response) {
                    var tbody = modal.find('.modal-body tbody');
                    tbody.empty(); // Xóa bất kỳ nội dung cũ nào trong tbody trước khi thêm mới

                    // Duyệt qua danh sách sản phẩm và thêm từng sản phẩm vào tbody
                    $.each(response, function (index, product) {
                        var row = '<tr>' +
                            '<td>' + product.ProductID + '</td>' +
                            '<td>' + product.ProductName + '</td>' +
                            '<td>' + product.Color + '</td>' +
                            '<td>' + product.Brand + '</td>' +
                            '<td>' + product.ProductType + '</td>' +
                            '</tr>';
                        tbody.append(row);
                    });
                },
                error: function (xhr, status, error) {
                    console.log(error);
                }
            });
        });
    });
</script>

