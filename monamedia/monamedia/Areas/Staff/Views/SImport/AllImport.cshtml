
@{
    ViewBag.Title = "Nhập hàng";
    Layout = "~/Areas/Staff/Views/Shared/StaffLayoutPage1.cshtml";
}
@model List<monamedia.ViewModels.ImportViewModel>
@section Styles
{
    <style>
        h2 {
            font-size: 30px;
            color: #333;
            text-align: center;
            margin-bottom: 20px;
        }

        .table tbody tr {
            background-color: #f8f9fa;
        }

        .btn {
            padding: 8px 20px;
            font-size: 14px;
        }

        .btn-primary {
            background-color: #007bff;
            border-color: #007bff;
        }

            .btn-primary:hover {
                background-color: #0056b3;
                border-color: #0056b3;
            }

        .btn-success {
            background-color: #28a745;
            border-color: #28a745;
        }

            .btn-success:hover {
                background-color: #218838;
                border-color: #218838;
            }

        .btn-danger {
            background-color: #f44336;
            border-color: #f44336;
        }

            .btn-danger:hover {
                background-color: #da190b;
                border-color: #da190b;
            }

        .navbar {
            margin-left: 90px;
        }

        .row.mb-3 {
            display: flex;
            align-items: center;
        }

            .row.mb-3 img {
                max-width: 60px;
                height: auto;
                display: block;
            }

        .table-container {
            border-radius: 10px;
            overflow: hidden;
            border: 2px solid #ced4da;
        }

        .custom-alert {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 30px;
            background-color: rgba(40, 167, 69, 0.5);
            color: #721c24;
            border: 1px solid #f5c6cb;
            border-radius: 5px;
            display: none;
        }
    </style>
}
<h2>Danh sách nhập hàng</h2>
<div id="orderContainer" class="container-fluid">
    <nav class="navbar navbar-light bg-light">
        <div class="container-fluid">
            <form class="d-flex" style="width:100%" onsubmit="return search()">
                <input id="searchInput" class="form-control me-2" type="search" placeholder="Nhập ngày nhập hàng" aria-label="Search" style="width: 80%">
                <button class="btn btn-outline-success" type="submit">Tìm kiếm</button>
            </form>
        </div>
    </nav>
    <div class="row justify-content-center">
        <div class="col-md-10">
            <div class="table-container">
                <table class="table">
                    <thead>
                        <tr>
                            <th scope="col">ID</th>
                            <th scope="col">Tên quản lý</th>
                            <th scope="col">Ngày nhập</th>
                            <th scope="col">Tổng tiền nhập</th>
                            <th scope="col">Chi tiết</th>
                            <th scope="col">Nhập hàng</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var order in Model)
                        {
                            <tr>
                                <td>@order.ImportID</td>
                                <td>@order.NameManager</td>
                                <td>@order.ImportDate</td>
                                <td>@(string.Format("{0:#,##0}", @order.Total)) đ</td>
                                <td>
                                    <button class="btn btn-primary details-button"
                                            data-bs-toggle="modal"
                                            data-bs-target="#detailModal"
                                            data-import-id="@order.ImportID"
                                            data-name="@order.NameManager"
                                            data-importdate="@order.ImportDate"
                                            data-total="@order.Total">
                                        Xem chi tiết
                                    </button>
                                </td>
                                <td><button class="btn btn-success import-button" data-import-id="@order.ImportID">Nhập hàng</button></td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="detailModal" tabindex="-1" aria-labelledby="detailModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="detailModalLabel">Chi tiết đơn nhập</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" style="max-height: 400px; overflow-y: auto;">
                <input type="hidden" id="modalProductID">
                <div class="row">
                    <div class="col-md-12">
                        <div class="form-group">
                            <label for="id"><strong>ID</strong></label>
                            <input type="text" class="form-control" id="id" readonly>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <div class="form-group">
                            <label for="name"><strong>Tên quản lý</strong></label>
                            <input type="text" class="form-control" id="name" readonly>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <div class="form-group">
                            <label for="importDate"><strong>Ngày nhập</strong></label>
                            <input type="text" class="form-control" id="importDate" readonly>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <div class="form-group">
                            <label for="importDetails"><strong>Danh sách sản phẩm nhập</strong></label>
                            <ul id="importDetails" class="list-group"></ul>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <div class="form-group">
                            <label for="total"><strong>Tổng tiền nhập</strong></label>
                            <input type="text" class="form-control" id="total" readonly>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
            </div>
        </div>
    </div>
</div>
<div id="confirmAlert" class="custom-alert" role="alert">
    <strong>Nhập hàng thành công!</strong>
</div>
<script src="~/Scripts/jquery-3.7.1.min.js"></script>
<script>
    function search() {
        var input, filter, table, tr, td, i, txtValue;
        input = document.getElementById("searchInput");
        filter = input.value.toUpperCase();
        table = document.querySelector(".table");
        tr = table.getElementsByTagName("tr");

        for (i = 0; i < tr.length; i++) {
            td = tr[i].getElementsByTagName("td")[2];
            if (td) {
                txtValue = td.textContent || td.innerText;
                if (txtValue.toUpperCase().indexOf(filter) > -1) {
                    tr[i].style.display = "";
                } else {
                    tr[i].style.display = "none";
                }
            }
        }
        return false;
    }
    function formatTime(time) {
        var date = new Date(time);
        var hours = date.getHours();
        var minutes = date.getMinutes();
        var day = date.getDate();
        var month = date.getMonth() + 1;
        var year = date.getFullYear();

        var formattedTime = hours + ':' + minutes + ' ' + day + '/' + month + '/' + year;

        return formattedTime;
    }
    function formatCurrency(amount) {
        return amount.toLocaleString('vi-VN', { style: 'currency', currency: 'VND' });
    }
    $(document).ready(function () {
        $('.table tbody tr td:nth-child(3)').each(function () {
            var dateStr = $(this).text();
            var date = new Date(dateStr);
            var day = date.getDate().toString().padStart(2, '0');
            var month = (date.getMonth() + 1).toString().padStart(2, '0');
            var year = date.getFullYear();
            var hours = date.getHours().toString().padStart(2, '0');
            var minutes = date.getMinutes().toString().padStart(2, '0');
            var seconds = date.getSeconds().toString().padStart(2, '0');
            var formattedDate = `${day}/${month}/${year} ${hours}:${minutes}:${seconds}`;
            $(this).text(formattedDate);
        });
        $('.details-button').click(function () {
            var importId = $(this).data('import-id');
            var modal = $('#detailModal');
            var modalBody = modal.find('.modal-body');
            var importDetailsList = modalBody.find('#importDetails');
            $.ajax({
                url: '/Staff/SImport/GetImportDetails',
                type: 'GET',
                data: { importID: importId },
                success: function (data) {

                    var productListHTML = '';
                    productListHTML += '<div class="row mb-3">';
                    productListHTML += '<div class="col"><span>Hình ảnh</span></div>';
                    productListHTML += '<div class="col"><span>Tên sản phẩm</span></div>';
                    productListHTML += '<div class="col"><span>Màu</span></div>';
                    productListHTML += '<div class="col"><span>Giá nhập</span></div>';
                    productListHTML += '<div class="col"><span>Giá bán</span></div>';
                    productListHTML += '<div class="col"><span>Số lượng</span></div>';
                    productListHTML += '</div>';
                    productListHTML += '<div class="table-container">';
                    $.each(data, function (index, item) {
                        productListHTML += '<div class="row mb-3">';
                        productListHTML += '<div class="col">';
                        productListHTML += '<img src="/img/' + item.ProductImage + '" alt="Product Image" class="img-thumbnail custom-img">';
                        productListHTML += '</div>';
                        productListHTML += '<div class="col">';
                        productListHTML += item.ProductName;
                        productListHTML += '</div>';
                        productListHTML += '<div class="col">';
                        productListHTML += item.ProductColor;
                        productListHTML += '</div>';
                        productListHTML += '<div class="col">';
                        productListHTML += parseFloat(item.PriceImport).toLocaleString('vi-VN', { style: 'currency', currency: 'VND' });
                        productListHTML += '</div>';
                        productListHTML += '<div class="col">';
                        productListHTML += parseFloat(item.Price).toLocaleString('vi-VN', { style: 'currency', currency: 'VND' });
                        productListHTML += '</div>';
                        productListHTML += '<div class="col">';
                        productListHTML += item.Quantity;
                        productListHTML += '</div>';
                        productListHTML += '</div>';
                    });
                    productListHTML += '</div>';

                    importDetailsList.html(productListHTML);

                },
                error: function (xhr, status, error) {
                    console.log('Error:', xhr, status, error);
                }
            });
            var name = $(this).data('name');
            var importdate = $(this).data('importdate');
            var total = $(this).data('total');
            var formattedTime = formatTime(importdate);
            var Total = formatCurrency(total);
            modal.find('#id').val(importId);
            modal.find('#name').val(name);
            modal.find('#importDate').val(formattedTime);
            modal.find('#total').val(Total);
        });
        $('.import-button').click(function () {
            var importId = $(this).data('import-id');
            $.ajax({
                url: '/Staff/SImport/ConfirmImport',
                type: 'POST',
                data: { importID: importId },
                success: function (response) {
                    var alertElement = document.getElementById("confirmAlert");
                    alertElement.style.display = "block";
                    setTimeout(function () {
                        alertElement.style.display = "none";
                        location.reload(true);
                    }, 1500);
                },
                error: function (xhr, status, error) {
                    console.log('Error:', xhr, status, error);
                }
            });
        });
    });
</script>
