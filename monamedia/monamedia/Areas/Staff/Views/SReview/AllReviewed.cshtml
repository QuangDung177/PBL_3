
@{
    ViewBag.Title = "Đã đánh giá";
    Layout = "~/Areas/Staff/Views/Shared/StaffLayoutPage1.cshtml";
}
@model List<monamedia.ViewModels.ReviewViewModel>
@section Styles
{
    <style>
        h2 {
            font-size: 30px;
            color: #333;
            text-align: center;
            margin-bottom: 20px;
        }

        .table tbody tr {
            background-color: #f8f9fa;
        }

        .btn {
            padding: 8px 20px;
            font-size: 14px;
        }

        .btn-primary {
            background-color: #007bff;
            border-color: #007bff;
        }

            .btn-primary:hover {
                background-color: #0056b3;
                border-color: #0056b3;
            }

        .btn-success {
            background-color: #28a745;
            border-color: #28a745;
        }

            .btn-success:hover {
                background-color: #218838;
                border-color: #218838;
            }

        .navbar {
            margin-left: 90px;
        }

        .row.mb-3 {
            display: flex;
            align-items: center;
        }

            .row.mb-3 img {
                max-width: 60px;
                height: auto;
                display: block;
            }

        .table-container {
            border-radius: 10px;
            overflow: hidden;
            border: 2px solid #ced4da;
        }

        #orderContainer .row {
            display: flex;
            align-items: center;
        }

        #orderContainer .col-md-6 {
            flex: 1;
        }


        #orderContainer .form-check-inline label {
            margin-bottom: 0;
        }

        .custom-alert {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 30px;
            background-color: rgba(40, 167, 69, 0.5);
            color: #721c24;
            border: 1px solid #f5c6cb;
            border-radius: 5px;
            display: none;
            z-index: 9999;
        }

        .product-img {
            max-width: 60px;
            max-height: 60px;
        }

        .star-rating {
            unicode-bidi: bidi-override;
            color: #f8ce0b;
            font-size: 20px;
            display: inline-block;
            overflow: hidden;
        }

            .star-rating .fa {
                font-size: inherit;
                color: inherit;
            }

            .star-rating .fa-star {
                float: right;
                padding-right: 2px;
            }

                .star-rating .fa-star.checked {
                    color: #f8ce0b;
                }

        .table tbody tr {
            display: table-row;
        }

        .table tbody td {
            vertical-align: middle;
        }
    </style>
}
<head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" integrity="sha512-..." crossorigin="anonymous" />
</head>

<h2>Danh sách đánh giá</h2>
<div id="orderContainer" class="container-fluid">
    <div class="row mb-3">
        <div class="col-md-6">
            <nav class="navbar navbar-light bg-light">
                <div class="container-fluid">
                    <form class="d-flex" style="width:100%" onsubmit="return search()">
                        <input id="searchInput" class="form-control me-2" type="search" placeholder="Nhập tên khách hàng" aria-label="Search" style="width: 80%">
                        <button class="btn btn-outline-success" type="submit">Tìm kiếm</button>
                    </form>
                </div>
            </nav>
        </div>
        <div class="col-md-6" style="display: flex; align-items: center; justify-content: flex-end;">
            <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="review" id="waiting" value="waiting">
                <label class="form-check-label" for="waiting">
                    Chưa phản hồi
                </label>
            </div>
            <div class="form-check form-check-inline" style="margin-right: 300px;">
                <input class="form-check-input" type="radio" name="review" id="reviewed" value="reviewed" checked>
                <label class="form-check-label" for="reviewed">
                    Đã phản hồi
                </label>
            </div>
        </div>
    </div>
    <div class="row justify-content-center">
        <div class="col-md-10">
            <div class="table-container">
                <table class="table">
                    <thead>
                        <tr>
                            <th scope="col">Khách hàng</th>
                            <th scope="col">Sản phẩm</th>
                            <th scope="col">Hình ảnh</th>
                            <th scope="col">Màu sắc</th>
                            <th scope="col">Số sao</th>
                            <th scope="col">Thời điểm đánh giá</th>
                            <th scope="col">Chi tiết</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var order in Model)
                        {
                            <tr>
                                <td>@order.NameCustomer</td>
                                <td>@order.NameProduct</td>
                                <td><img class="product-img" src="~/img/@order.ImageUrl" alt="Alternate Text" /></td>
                                <td>@order.ProductColor</td>
                                <td>
                                    <div class="star-rating">
                                        @for (int i = 0; i < order.Star; i++)
                                        {
                                            <span class="fa fa-star checked"></span>
                                        }
                                    </div>
                                </td>
                                <td scope="row">@order.CmtTime</td>
                                <td>
                                    <button class="btn btn-primary details-button"
                                            data-bs-toggle="modal"
                                            data-bs-target="#replyModal"
                                            data-cmt-staff="@order.CmtStaff"
                                            data-cmt-customer="@order.CmtCustomer">
                                        Chi tiết 
                                    </button>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="replyModal" tabindex="-1" aria-labelledby="replyModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Phản hồi</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" style="max-height: 400px; overflow-y: auto;">
                <div class="form-group">
                    <label for="customerComment">Bình luận của khách hàng:</label>
                    <textarea class="form-control" id="customerComment" rows="4" readonly></textarea>
                </div>
                <div class="form-group">
                    <label for="staffReply">Phản hồi của nhân viên:</label>
                    <textarea class="form-control" id="staffReply" rows="4" readonly></textarea>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="~/Scripts/jquery-3.7.1.min.js"></script>
<script>
    function search() {
        var input, filter, table, tr, td, i, txtValue;
        input = document.getElementById("searchInput");
        filter = input.value.toUpperCase();
        table = document.querySelector(".table");
        tr = table.getElementsByTagName("tr");

        for (i = 0; i < tr.length; i++) {
            td = tr[i].getElementsByTagName("td")[0];
            if (td) {
                txtValue = td.textContent || td.innerText;
                if (txtValue.toUpperCase().indexOf(filter) > -1) {
                    tr[i].style.display = "";
                } else {
                    tr[i].style.display = "none";
                }
            }
        }
        return false;
    }
    $(document).ready(function () {
        $('.details-button').click(function () {
            var cmtCustomer = $(this).data('cmt-customer');
            var cmtStaff = $(this).data('cmt-staff');
            $('#customerComment').val(cmtCustomer);
            $('#staffReply').val(cmtStaff);
        });
    });
    $('input[type=radio][name=review]').change(function () {
        var selectedValue = $('input[type=radio][name=review]:checked').val();
        switch (selectedValue) {
            case 'waiting':
                window.location.href = '/Staff/SReview/AllReview';
                break;
            case 'reviewed':
                window.location.href = '/Staff/SReview/AllReviewed';
                break;
            default:
                break;
        }
    });
</script>
