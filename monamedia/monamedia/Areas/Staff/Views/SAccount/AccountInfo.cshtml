@{
    ViewBag.Title = "Thông tin tài khoản";
    Layout = "~/Areas/Staff/Views/Shared/StaffLayoutPage1.cshtml";
}

@section Styles
{
    <style>
   
        .form-group label {
            font-weight: bold;
        }

        .form-custom {
            border: 2px solid #007bff;
            border-radius: 20px;
            padding: 20px;
            margin: auto;
            max-width: 600px;
        }

        .form-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }



        .change-password-btn {
            margin-top: 10px;
        }

            .change-password-btn button {
                width: 100%;
            }

        .input-group {
            position: relative;
        }

        .input-group-append {
            position: absolute;
            margin-top: 4px;
            right: 2px;
        }
        .custom-alert {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 30px;
            background-color: rgba(40, 167, 69, 0.5);
            color: #721c24;
            border: 1px solid #f5c6cb;
            border-radius: 5px;
            display: none;
            z-index:9999;
        }
    </style>
}
<head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" integrity="sha512-..." crossorigin="anonymous" />
</head>
<h2 class="my-4 text-center">Thay Đổi Thông Tin Tài Khoản</h2>
<form action="#" class="form-custom">
    <div class="row">
        <div class="col-md-6">
            <div class="form-group">
                <label for="username">Tên người dùng:</label>
                <input type="text" class="form-control" id="username" name="username" readonly>
            </div>
        </div>
        <div class="col-md-6">
            <div class="form-group">
                <label for="password">Mật khẩu:</label>
                <div class="input-group">
                    <input type="password" class="form-control" id="password" name="password" readonly>
                    <div class="input-group-append">
                        <span class="input-group-text" id="toggle-password">
                            <i class="fas fa-eye"></i>
                        </span>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="form-group">
                <label for="email">Email:</label>
                <input type="email" class="form-control" id="email" name="email" required>
            </div>
        </div>
        <div class="col-md-6">
            <div class="form-group">
                <label for="fullname">Họ và tên:</label>
                <input type="text" class="form-control" id="fullname" name="fullname">
            </div>
        </div>
        <div class="col-md-6">
            <div class="form-group">
                <label for="dob">Ngày sinh:</label>
                <input type="date" class="form-control" id="dob" name="dob">
            </div>
        </div>
        <div class="col-md-6">
            <div class="form-group">
                <label>Giới tính:</label><br>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" id="male" name="gender" value="male">
                    <label class="form-check-label" for="male">Nam</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" id="female" name="gender" value="female">
                    <label class="form-check-label" for="female">Nữ</label>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="form-group">
                <label for="address">Địa chỉ:</label>
                <input type="text" class="form-control" id="address" name="address">
            </div>
        </div>
        <div class="col-md-6">
            <div class="form-group">
                <label for="phone">Số điện thoại:</label>
                <input type="tel" class="form-control" id="phone" name="phone">
            </div>
        </div>
        <div class="col-md-6">
            <div class="form-group">
                <label for="salary">Lương:</label>
                <input type="text" class="form-control" id="salary" name="salary" readonly>
            </div>
        </div>
        <div class="form-actions">
            <div class="change-password-btn">
                <button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#changePasswordModal">Đổi mật khẩu</button>
            </div>
            <button type="submit" class="btn btn-primary update-btn">Cập nhật</button>
        </div>
    </div>
</form>
<div class="modal fade" id="changePasswordModal" tabindex="-1" aria-labelledby="changePasswordModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-md modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="changePasswordModalLabel">Đổi mật khẩu</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="changePasswordForm">
                    <div class="form-group">
                        <label for="currentPassword">Mật khẩu cũ:</label>
                        <input type="password" class="form-control" id="currentPassword" name="currentPassword" required>
                    </div>
                    <div class="form-group">
                        <label for="newPassword">Mật khẩu mới:</label>
                        <input type="password" class="form-control" id="newPassword" name="newPassword" required>
                    </div>
                    <div class="form-group">
                        <label for="confirmNewPassword">Xác nhận mật khẩu mới:</label>
                        <input type="password" class="form-control" id="confirmNewPassword" name="confirmNewPassword" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary changepassword-btn">Đổi mật khẩu</button>
            </div>
        </div>
    </div>
</div>
<div id="changepasswordAlert" class="custom-alert" role="alert">
    <strong>Đổi mật khẩu thành công</strong>
</div>
<div id="updateInfoAlert" class="custom-alert" role="alert">
    <strong>Cập nhật thông tin thành công</strong>
</div>
<script src="~/Scripts/jquery-3.7.1.min.js"></script>
<script src="https://kit.fontawesome.com/a076d05399.js"></script>
<script>
    $(document).ready(function () {
        var accountID=@ViewBag.accountId;
        $.ajax({
            url: '/Staff/SAccount/GetAccountInfo',
            type: 'GET',
            data: { id: accountID },
            success: function (data) {
                $('#username').val(data.userName);
                $('#password').val(data.password);
                $('#email').val(data.email);
                $('#fullname').val(data.fullName);
                var dateString = data.birthDate;
                var milliseconds = parseInt(dateString.replace(/\/Date\((-?\d+)\)\//, '$1'));
                var date = new Date(milliseconds);
                var year = date.getFullYear();
                var month = (date.getMonth() + 1).toString().padStart(2, "0");
                var day = date.getDate().toString().padStart(2, "0");
                var formattedDate = `${year}-${month}-${day}`;
                $('#dob').val(formattedDate);
                $('#address').val(data.address);
                $('#phone').val(data.phone);
                var formattedSalary = formatMoney(data.salary);
                $('#salary').val(formattedSalary);
                if (data.gender ==true) {
                    $('#male').prop('checked', true);
                } else {
                    $('#female').prop('checked', true);
                }
            },
            error: function () {
                console.log('Error:', xhr, status, error);
            }
        });
    });
    $(document).ready(function () {
        var passwordField = $('#password');
        $('#toggle-password').click(function () {
            var type = passwordField.attr('type') === 'password' ? 'text' : 'password';
            passwordField.attr('type', type);
            $(this).find('i').toggleClass('fa-eye fa-eye-slash');
        });
    });
    $(document).ready(function () {
    $('.update-btn').click(function (e) {
        var gender1 = $('input[name="gender"]:checked').val() === 'male' ? true : false;
        var accountID= @ViewBag.accountId;
        var email= $('#email').val();
        var name=$('#fullname').val();
        var birthDate= $('#dob').val();
        var address= $('#address').val();
        var phone = $('#phone').val();
        var gender = gender1;
        $.ajax({
            url: '/Staff/SAccount/EditProfile',
            type: 'POST',
            dataType: 'json',
            data: {
                id: accountID,
                name: name,
                email: email,
                phone: phone,
                address: address,
                birthdate:birthDate,
                gender: gender
            },
            success: function (response) {
                var alertElement = document.getElementById("updateInfoAlert");
                alertElement.style.display = "block";
                setTimeout(function () {
                    alertElement.style.display = "none";
                    location.reload(true);
                }, 1500);
            },
            error: function () {
                console.log("sai");
            }
        });
    });
});
$(document).ready(function () {
    $('#changePasswordModal').on('shown.bs.modal', function () {
        $('#currentPassword').val('');
        $('#newPassword').val(''); 
        $('#confirmNewPassword').val(''); 
    });
    $('.changepassword-btn').click(function (e) {
        var currentPassword = $('#currentPassword').val();
        var newPassword = $('#newPassword').val();
        var confirmNewPassword = $('#confirmNewPassword').val();
        if (newPassword !== confirmNewPassword) {
            alert("Mật khẩu mới và xác nhận mật khẩu mới không khớp!");
            return; 
        }
        var alertElement = document.getElementById("changepasswordAlert");
        alertElement.style.display = "block";
        var accountID = @ViewBag.accountId;
        $.ajax({
            url: '/Staff/SAccount/ChangePassword',
            type: 'POST',
            dataType: 'json',
            data: {
                id: accountID,
                oldPassword: currentPassword,
                newPassword: newPassword
            },
            success: function (response) {
                var alertElement = document.getElementById("changepasswordAlert");
                alertElement.style.display = "block";
                setTimeout(function () {
                    alertElement.style.display = "none";
                    location.reload(true);
                }, 1500);
            },
            error: function () {
                console.log("Có lỗi xảy ra khi đổi mật khẩu!");
            }
        });
    });
});
    function formatMoney(amount) {
        return new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(amount);
    }
</script>
